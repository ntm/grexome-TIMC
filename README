Exome pipeline from TIMC in Grenoble - primary analyses:
from FASTQs to a single multi-sample GVCF per variant-caller.

The pipeline currently performs variant-calling independently with Strelka2, GATK4 and elPrep5.


EXAMPLE USAGE:
**************
perl grexome-TIMC-Primary/grexome-TIMC-primary.pl --samplesFile=Grexome_Metadata/samples.xlsx --workdir=PrimaryAnalyses_TEST --config=Grexome_Metadata/prim_config.pm &> grexomeTIMCprim.log &

This will "process" every sampleID in samples.xlsx, ie:
- produce analysis-ready BAMs (trim, align, mark dupes, sort);
- produce individual GVCFs with STRELKA2, GATK4 and ELPREP5;
- fix variant-caller quirks and bugs, filter low-quality variant calls;
- produce a single multi-sample merged GVCF per variant-caller.

BAMs and GVCFs are produced in a hierarchy of subdirs defined at the top of grexome-TIMC-primary.pl, all within \$dataDir (defined in prim_config.pm) which you should customize.
Logs and copies of the metadata are produced in PrimaryAnalyses_TEST/ .
For each sample, any step where the result file already exists is skipped.

Extensive documentation is obtained with:
perl grexome-TIMC-primary.pl --help


METADATA FILES:
***************
The pipeline uses a single metadata XLSX file, which describes the samples. This metadata file (and the code that parses it, in grexome_metaParse.pm) is shared with the grexome-TIMC-Secondary pipeline [1]. Therefore some columns are required in the XLSX despite not being used in this primary pipeline. The provided example file [2] can serve as a starting point. All columns present in this file (and listed below) are required, don't change their names! You can add new columns and/or change the order of columns to your taste, just don't touch the pre-existing column names. 
Required columns:
- sampleID: unique identifier for each sample, these are typically created with a uniform naming scheme when new samples are integrated into the pipeline and are used internally throughout the pipeline. Rows with sampleID=="0" are ignored, this allows to retain metadata info about obsolete samples.
- specimenID: external identifier for each sample, typically related to the original FASTQ filenames.
- patientID: can be empty, ignored in grexome-TIMC-Primary.
- pathologyID: required (alphanumeric string) but ignored in grexome-TIMC-Primary.
- Causal gene: can be empty, ignored in grexome-TIMC-Primary.

[1] https://github.com/ntm/grexome-TIMC-Secondary
[2] https://github.com/ntm/grexome-TIMC-Secondary/blob/master/Documentation/samples.xlsx


CONFIGURATION:
**************
Before using the pipeline you must customize the grexomeTIMCprim_config.pm file, which defines every install-specific variable (eg path+name of the reference human genome fasta file). Every subroutine in grexomeTIMCprim_config.pm is self-documented and will need to be customized. To do this you can either copy the file somewhere and edit the copy, then use --config; or edit the distributed copy in-place (not as flexible).


DEPENDENCIES:
*************
We try to keep external dependencies to a minimum. The only required perl modules are listed below. Most are standard core modules and should already be available on your system, a few will probably need to be installed from your distribution's standard repositories (e.g. "sudo yum install perl-Parallel-ForkManager perl-Spreadsheet-XLSX" on RHEL7).
Standard core modules: Exporter, File::Basename, File::Copy, File::Glob, File::Path, File::Spec, File::Temp, FindBin, Getopt::Long, POSIX.
Other modules: Parallel::ForkManager, Spreadsheet::XLSX.

In addition, we use the following programs. They must be installed and should be in your PATH, but you can easily customize their names and paths if needed (check the scripts).
grexome-TIMC-primary.pl: bgzip, tabix, zgrep;
1_fastq2bam.pl: fastp, bwa OR bwa-mem2, samblaster, samtools, bwa-postalt.js and k8 from Heng Li's BWA-kit package;
2_bam2gvcf_strelka.pl: configureStrelkaGermlineWorkflow.py (from STRELKA2);
2_bam2gvcf_gatk.pl: gatk (from GATK4);
2_bam2gvcf_elprep.pl: elprep (from ELPREP5)


OTHER REPO CONTENT:
*******************

##### PREP STEP #####
0_grexomizeFastqs.pl : house-keeping script used to organize our FASTQ files before running the grexome-TIMC-primary pipeline. It parses the samples.xlsx metadata file and takes original fastqs to produce a consolidated uniform dataset of "grexomized" fastqs. It's probably not re-usable as-is.

##### "PACKAGED" VERSIONS FOR RUNNING SOME STEPS ON CLUSTERS #####
Fastq2Bam_PackagedWithBinaries_Centos7/ :
Bam2gvcf_Strelka_PackagedWithBinaries_Centos7/ :
Bam2gvcf_GATK_PackagedWithBinaries_Centos7/ :
"packages" for running fastq2bam, bam2gvcf_strelka or bam2gvcf_gatk on other systems / compute clusters, eg f-dahu. Each subdir has its README. Probably not re-usable as-is.

##### EXPERIMENTAL STEPS, NOT USED #####
4_CombineGVCFs_GATK/ : attempt to use GATK CombineGVCFs, crazy slow.
4_GVCFs2GenomicsDB/ : import single-sample GATK GVCFs into a GenomicsDB.
5_GenomicsDB2VCF/ : perform joint genotyping with GATK GenotypeGVCFs from a GenomicsDB. Unusably slow.

